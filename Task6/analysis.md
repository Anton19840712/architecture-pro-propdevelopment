# Отчёт по результатам анализа Kubernetes Audit Log

## Подозрительные события

### 1. Доступ к секретам
- **Кто:** system:serviceaccount:secure-ops:monitoring
- **Где:** namespace kube-system, ресурс secrets
- **Почему подозрительно:** ServiceAccount из namespace secure-ops запрашивает секреты из kube-system. Нарушение принципа минимальных привилегий — мониторинг не должен иметь доступа к секретам других namespace.

### 2. Привилегированные поды
- **Кто:** пользователь, выполняющий simulate-incident.sh
- **Комментарий:** Создан под `privileged-pod` с `securityContext.privileged: true`. Привилегированный под имеет полный доступ к хосту, может читать/писать файлы хоста, монтировать устройства. Критическая уязвимость — возможен побег из контейнера.

### 3. Использование kubectl exec в чужом поде
- **Кто:** пользователь скрипта
- **Что делал:** exec в под coredns (namespace kube-system) с командой `cat /etc/resolv.conf`
- **Почему подозрительно:** Выполнение команд в системных подах. Может использоваться для разведки сети, извлечения конфигурации DNS, lateral movement.

### 4. Создание RoleBinding с правами cluster-admin
- **Кто:** пользователь скрипта
- **К чему привело:** ServiceAccount `monitoring` получил права `cluster-admin` через RoleBinding `escalate-binding`. Это эскалация привилегий — сервисный аккаунт мониторинга теперь имеет полный контроль над кластером.

### 5. Удаление audit-policy.yaml
- **Кто:** пользователь с ролью admin
- **Возможные последствия:** Попытка отключить аудит для сокрытия последующих вредоносных действий. Если бы удаление прошло успешно, дальнейшие действия атакующего не логировались бы.

## Ошибки политики RBAC

1. **Избыточные права monitoring:** ServiceAccount мониторинга не должен иметь права на чтение секретов в других namespace.

2. **Отсутствие ограничений на создание RoleBinding:** Любой пользователь с правами create на rolebindings может эскалировать привилегии.

3. **Нет запрета на привилегированные поды:** PodSecurityPolicy/PodSecurity Admission не настроены — любой может создать привилегированный под.

4. **Нет ограничений на exec:** Отсутствует контроль, кто может выполнять exec в какие поды.

## Вывод

Обнаружена цепочка атаки с эскалацией привилегий:
1. Использование легитимного ServiceAccount для разведки (доступ к secrets)
2. Создание привилегированного пода для побега из контейнера
3. Exec в системные поды для lateral movement
4. Эскалация до cluster-admin через RoleBinding
5. Попытка отключения аудита для сокрытия следов

**Рекомендации:**
- Внедрить PodSecurity Admission с уровнем restricted
- Настроить OPA Gatekeeper для блокировки привилегированных подов
- Ограничить права на создание RoleBinding/ClusterRoleBinding
- Настроить алерты на подозрительные события в SIEM
