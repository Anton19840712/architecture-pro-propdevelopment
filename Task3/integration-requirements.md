# Требования к безопасности интеграций Умный дом

## 1. Требования к безопасности данных

### 1.1 Биометрические данные
- Хранение только в зашифрованном виде (AES-256)
- HashiCorp Vault для управления ключами
- Передача партнёру только хэшей/векторов, не фото
- Право на удаление по запросу субъекта

### 1.2 Номера автомобилей
- Классификация: конфиденциальные данные
- Шифрование at-rest
- Логирование всех операций

### 1.3 Общие требования
- TDE в PostgreSQL
- TLS 1.3 для передачи
- Маскирование в логах

---

## 2. Протоколы аутентификации и авторизации

### 2.1 Пользователи
- OAuth 2.0 + OpenID Connect (Keycloak)
- MFA для управления биометрией
- JWT с коротким сроком жизни (15 мин)

### 2.2 Системы
- PropDevelopment → Партнёр: OAuth 2.0 Client Credentials + mTLS
- Партнёр → PropDevelopment: API Key + mTLS + IP whitelist

### 2.3 Авторизация
- RBAC на уровне Keycloak
- ABAC для проверки tenant_id
- Роли: owner:read, owner:manage, admin:audit

---

## 3. Схема взаимодействия

### 3.1 Компоненты

| Компонент | Назначение |
|-----------|------------|
| smart-home-service | Бизнес-логика интеграции |
| smart-home-db | Настройки устройств |
| biometric-vault | Шифрование биометрии |
| API Gateway | mTLS, rate limiting |

### 3.2 Поток регистрации лица
```
1. Собственник → Mobile App: загрузка фото
2. Mobile App → auth-service: проверка MFA
3. Mobile App → smart-home-service: передача фото
4. smart-home-service → biometric-vault: шифрование
5. smart-home-service → Партнёр: передача вектора
6. Партнёр → Домофон: синхронизация
```

### 3.3 Требования к API Gateway
- Rate limit: 100 req/min
- Timeout: 5 сек
- Circuit breaker

### 3.4 Требования к партнёру
- Не хранить биометрию > 24ч
- SLA 99.9%
- Уведомление об инцидентах < 1ч
- SOC 2 аудит

---

## 4. Соответствие

| Требование | Решение |
|------------|---------|
| ФЗ-152 | Согласие на обработку, право на удаление |
| GDPR | Data minimization |
